---
title: "bootstrap practice"
author: "Evi_et_al"
date: "2024-04-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
##installing packages
#install.packages("ggthemes")
#install.packages("moderndive")
#install.packages("NHANES")

# load packages
library(countdown)
library(tidyverse)
library(gt)
library(readxl)
library(knitr)
library(tidyverse)
library(ggthemes)
library(moderndive)
library(NHANES)
library(infer)
# set theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# set width of code output
options(width = 65)

# set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7, # 7" width
  fig.asp = 0.618, # the golden ratio
  fig.retina = 3, # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300 # higher dpi, sharper image
)
```


```{r}
#grabbing sleep data
NHANES <- NHANES %>%
  select(SleepHrsNight)

```

```{r}
#finding the sample mean
samp_mean <- NHANES %>% summarize(m = mean(SleepHrsNight, na.rm = T))
samp_mean


```
```{r}
#visualizing the sample data
ggplot(data = NHANES, aes(x = SleepHrsNight)) +
  geom_histogram(binwidth = 1) + geom_vline(xintercept = samp_mean$m, color = 'darkred') +
  labs(x = 'Daily sleep (in hours)', y = 'Count',
       title = 'Hours of sleep per night in the sample')


```

```{r}
#taking a single bootstrap sample -> sample mean
NHANES %>% 
  rep_sample_n(size = nrow(NHANES), replace = TRUE, reps = 1) %>%
  summarize(m = mean(SleepHrsNight, na.rm=T))


```

```{r}
#taking a thousand boostrap sample means
bootstrap_means <- NHANES %>% 
  rep_sample_n(size = nrow(NHANES), replace = TRUE, reps = 1000) %>% # to note size = original sample size
  group_by(replicate) %>% # and with replacement
  summarize(x_bar = mean(SleepHrsNight, na.rm=T)) 

bootstrap_means %>%
  slice_head(n = 10)


```

```{r}
#finding/visualizing the bootstrap distribution
bootstrap_means %>%
  ggplot(aes(x=x_bar)) + 
  geom_histogram() + geom_vline(xintercept = mean(bootstrap_means$x_bar), color = 'darkred') +
  labs(x = 'Bootstrap means', y = 'Count',
       title = 'Bootstrap sampling distribution')


```

```{r}
#finding mean/SE of the bootstrap sampling distribution
stats <- bootstrap_means %>%
  summarize(avg_sleep = mean(x_bar),
            std_err_sleep = sd(x_bar))
stats


```
#confidence interval time
```{r}
#Standard Error method
stats <- stats  %>%
  mutate(lower_bound = avg_sleep - 2*std_err_sleep,
         upper_bound = avg_sleep + 2*std_err_sleep)
stats

#visualizing
ggplot(data=bootstrap_means, aes(x=x_bar)) + 
  geom_histogram() +
  geom_vline(xintercept = stats$lower_bound, color = 'blue') +
   geom_vline(xintercept = stats$upper_bound, color = 'blue')

```

```{r}
#percentile method
q <- bootstrap_means %>%
  summarize(
    lower_bound = quantile(x_bar, probs = c(.025)),
    upper_bound = quantile(x_bar, probs = c(.975))
  )
q

#visualization
ggplot(data=bootstrap_means, aes(x=x_bar)) + 
  geom_histogram() +
  geom_vline(xintercept = q$lower_bound, color = 'red') +
   geom_vline(xintercept = q$upper_bound, color = 'red')


```







